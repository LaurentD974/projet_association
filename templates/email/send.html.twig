{# templates/email/send.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Envoyer un email{% endblock %}

{% block body %}
<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>üì§ Envoyer un message √† ma corporation</h2>
    <a href="{{ path('gacheur_dashboard') }}" class="btn btn-outline-secondary">
      ‚¨ÖÔ∏è Retour au Dashboard
    </a>
  </div>

  {% for message in app.flashes('success') %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
    </div>
  {% endfor %}

  <div class="card shadow-sm">
    <div class="card-body">
      {{ form_start(form) }}

      <div class="mb-3">
        {{ form_label(form.expediteur) }}
        {{ form_widget(form.expediteur, {'attr': {'class': 'form-control'}}) }}
        {{ form_errors(form.expediteur) }}
      </div>

      <div class="mb-3">
        {{ form_label(form.message) }}
        {{ form_widget(form.message, {'attr': {'class': 'form-control', 'rows': 6}}) }}
        {{ form_errors(form.message) }}
      </div>

      {# --- Destinataires en cases √† cocher (coch√©es par d√©faut via FormType/contr√¥leur) --- #}
      <div class="mb-3">
        {{ form_label(form.destinataires) }}
        {{ form_errors(form.destinataires) }}

        <div class="form-check mb-2">
          <input id="toggle-all" type="checkbox" class="form-check-input" checked>
          <label for="toggle-all" class="form-check-label">Tout cocher / d√©cocher</label>
        </div>

        <div id="destinataires-group" class="vstack gap-1">
          {% for choice in form.destinataires %}
            <div class="form-check">
              {{ form_widget(choice, {'attr': {'class': 'form-check-input'}}) }}
              {{ form_label(choice, null, {'label_attr': {'class': 'form-check-label'}}) }}
            </div>
          {% endfor %}
        </div>
      </div>

      <button type="submit" class="btn btn-primary">
        ‚úâÔ∏è Envoyer le message
      </button>

      {{ form_end(form) }}
    </div>
  </div>
</div>

{# Toggle JS tr√®s l√©ger #}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const toggle = document.getElementById('toggle-all');
  const group  = document.getElementById('destinataires-group');
  if (toggle && group) {
    const boxes = group.querySelectorAll('input[type="checkbox"]');
    toggle.addEventListener('change', () => {
      boxes.forEach(cb => cb.checked = toggle.checked);
    });
  }
});
</script>
{% endblock %}
