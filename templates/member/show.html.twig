{% extends 'base.html.twig' %}

{% block title %}Profil du membre{% endblock %}

{% block body %}
<div class="container my-5">

  {# Titre + actions #}
  <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 mb-4">
    <h1 class="h4 m-0">Profil de {{ member.prenom }} {{ member.nom }}</h1>

    <div class="d-flex flex-wrap gap-2">
      <a href="{{ path('user_search') }}" class="btn btn-outline-primary">üîô Trombinoscope</a>
      <a href="{{ path('home') }}" class="btn btn-outline-secondary">üè† Accueil</a>

      {% if app.user and ('ROLE_GACHEUR' in app.user.roles or 'ROLE_ADMIN' in app.user.roles) %}
        <a
          href="{% if 'ROLE_ADMIN' in app.user.roles %}{{ path('admin_dashboard') }}{% else %}{{ path('gacheur_dashboard') }}{% endif %}"
          class="btn {% if 'ROLE_ADMIN' in app.user.roles %}btn-dark{% else %}btn-success{% endif %}"
        >
          {% if 'ROLE_ADMIN' in app.user.roles %}üõ†Ô∏è Dashboard Admin{% else %}üéØ Dashboard G√¢cheur{% endif %}
        </a>
      {% endif %}
    </div>
  </div>

  <div class="row g-4">
    {# Colonne photo #}
    <div class="col-12 col-md-4">
      <div class="card shadow-sm h-100">
        <div class="ratio ratio-1x1">
          {% if member.photo %}
            <img
              src="{{ asset('uploads/photos/' ~ member.photo) }}"
              alt="Photo de {{ member.nom }} {{ member.prenom }}"
              class="w-100 h-100 rounded-top"
              style="object-fit:cover"
              onerror="this.onerror=null;this.src='{{ asset('image/default-avatar.png') }}';"
            >
          {% else %}
            <img
              src="{{ asset('image/default-avatar.png') }}"
              alt="Photo par d√©faut de {{ member.nom }} {{ member.prenom }}"
              class="w-100 h-100 rounded-top"
              style="object-fit:cover"
            >
          {% endif %}
        </div>
        <div class="card-body">
          <h2 class="h5 mb-1">{{ member.prenom }} {{ member.nom }}</h2>
          {% if member.metier %}
            <div class="text-muted small mb-2"><i class="bi bi-tools me-1"></i>{{ member.metier }}</div>
          {% endif %}

          {# Badges √©tat/position si pr√©sents #}
          <div class="d-flex flex-wrap gap-2">
            {% if member.statut %}
              <span class="badge bg-primary-subtle text-primary border border-primary-subtle">{{ member.statut }}</span>
            {% endif %}
            {% if member.position %}
              <span class="badge bg-secondary-subtle text-secondary border border-secondary-subtle">{{ member.position }}</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    {# Colonne infos #}
    <div class="col-12 col-md-8">
      <div class="card shadow-sm h-100">
        <div class="card-header">
          <strong>Informations</strong>
        </div>
        <div class="card-body p-0">
          <div class="list-group list-group-flush">

            {% if member.fonction1 or member.fonction2 %}
              <div class="list-group-item">
                <div class="fw-semibold">G√¢che(s)</div>
                <div class="small text-body-secondary">
                  {{ member.fonction1|default('') }} {{ member.fonction2|default('') }}
                </div>
              </div>
            {% endif %}

            {% if member.nomprovince or member.nomcompagnon %}
              <div class="list-group-item">
                <div class="fw-semibold">Nom de province</div>
                <div class="small text-body-secondary">
                  {{ member.nomprovince|default('') }} {{ member.nomcompagnon|default('') }}
                </div>
              </div>
            {% endif %}

            {% if member.telephone %}
              <div class="list-group-item">
                <div class="fw-semibold">T√©l√©phone</div>
                <div class="small"><a href="tel:{{ member.telephone }}">{{ member.telephone }}</a></div>
              </div>
            {% endif %}

            {% if member.email %}
              <div class="list-group-item">
                <div class="fw-semibold">Email</div>
                <div class="small">
                  ‚úâÔ∏è <a href="mailto:{{ member.email }}">{{ member.email }}</a>
                </div>
              </div>
            {% endif %}

            {% if member.passetemps is not null %}
              <div class="list-group-item">
                <div class="fw-semibold">Passe-temps</div>
                <div class="small text-body-secondary">{{ member.passetemps }}</div>
              </div>
            {% endif %}

            {% if member.adresse1 or member.adresse2 or member.codepostale or member.ville %}
              <div class="list-group-item">
                <div class="fw-semibold">Adresse</div>
                <div class="small text-body-secondary">
                  {{ member.adresse1|default('') }}{% if member.adresse1 and (member.adresse2 or member.codepostale or member.ville) %}<br>{% endif %}
                  {{ member.adresse2|default('') }}{% if member.adresse2 and (member.codepostale or member.ville) %}<br>{% endif %}
                  {{ member.codepostale|default('') }} {{ member.ville|default('') }}
                </div>
              </div>
            {% endif %}

            <div class="list-group-item">
              <div class="fw-semibold">Entreprise</div>
              <div class="small">
                {% if member.entreprise %}
                  <a href="{{ path('entreprise_show', { id: member.entreprise.id }) }}">
                    {{ member.entreprise.nom }}
                  </a>
                {% else %}
                  <span class="text-body-secondary">Non attribu√©e</span>
                {% endif %}
              </div>
            </div>

            {% if member.dateArrivee is not null %}
              <div class="list-group-item">
                <div class="fw-semibold">Date d'arriv√©e</div>
                <div class="small text-body-secondary">{{ member.dateArrivee|date('d/m/Y') }}</div>
              </div>
            {% endif %}

            {% if member.dateDepart is not null %}
              <div class="list-group-item">
                <div class="fw-semibold">Date de d√©part</div>
                <div class="small text-body-secondary">{{ member.dateDepart|date('d/m/Y') }}</div>
              </div>
            {% endif %}

          </div>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}
